<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Verify Identity</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="auth-wrapper">
        <div class="glass-card">
            <h2>Verify It's You</h2>
            <p style="margin-bottom: 10px;">We sent a code to <strong>{{ contact }}</strong></p>
            <p style="font-size: 0.85rem; color: #F59E0B; margin-bottom: 30px;">
                <i class="fas fa-terminal"></i> Check your Server Console for the code!
            </p>

            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}{% for category, message in messages %}<div class="alert alert-{{ category }}">{{ message }}</div>{% endfor %}{% endif %}
            {% endwith %}

            <form action="{{ url_for('verify_otp') }}" method="POST">
                <input type="hidden" name="contact_key" value="{{ contact }}">
                <input type="hidden" name="context_type" value="{{ context }}">
                
                <div class="form-group" style="text-align:center;">
                    <input type="text" name="otp" placeholder="1 2 3 4 5 6" 
                           style="text-align:center; letter-spacing: 10px; font-size: 1.5rem; font-weight: 700; width: 250px;" 
                           maxlength="6" required>
                </div>
                
                <button type="submit" class="btn">Verify Code</button>
            </form>

            <div class="resend-container">
                Didn't receive it? 
                <a href="{{ url_for('resend_otp', contact=contact, method=method) }}" id="resendLink" class="text-link disabled">
                    Resend Code <span id="timer">(60s)</span>
                </a>
            </div>
            
            <div style="margin-top: 30px;">
                <a href="{{ url_for('login') }}" style="color:#999; text-decoration:none;">Cancel</a>
            </div>
        </div>
    </div>

    <script>
        let timeLeft = 60;
        const timerElem = document.getElementById('timer');
        const resendLink = document.getElementById('resendLink');

        const countdown = setInterval(() => {
            timeLeft--;
            timerElem.innerText = `(${timeLeft}s)`;
            if (timeLeft <= 0) {
                clearInterval(countdown);
                timerElem.innerText = "";
                resendLink.classList.remove('disabled');
            }
        }, 1000);
    </script>
</body>
</html>