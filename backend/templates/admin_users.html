<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Management</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<body>
    <nav style="position: fixed; top: 0; left: 0; width: 100%; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; z-index: 100; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);">
        <h3 style="color: #6C63FF; margin: 0;">Admin Dashboard</h3>
        <div style="display: flex; gap: 15px; align-items: center;">
            <span style="color: #636e72; font-size: 14px;">Logged as: <strong>{{ current_admin }}</strong></span>
            <a href="{{ url_for('logout') }}" class="btn" style="width: auto; padding: 8px 20px; background: #ff7675; margin: 0; font-size: 14px;">Log Out</a>
        </div>
    </nav>

    <div class="container">
        <div class="glass-card" style="text-align: left; padding-top: 30px;">
            
            <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:30px;">
                <div class="admin-nav">
                    <a href="{{ url_for('admin_users') }}" class="{{ 'active' if request.endpoint == 'admin_users' else '' }}">
                        <i class="fas fa-users"></i> Users
                    </a>
                    <a href="{{ url_for('admin_contributions') }}" class="{{ 'active' if request.endpoint == 'admin_contributions' else '' }}">
                        <i class="fas fa-inbox"></i> Contributions
                    </a>
                    <a href="{{ url_for('admin_history') }}" class="{{ 'active' if request.endpoint == 'admin_history' else '' }}">
                        <i class="fas fa-history"></i> History
                    </a>
                </div>
                
                <button onclick="document.getElementById('addUserModal').style.display='flex'" class="btn" style="width: auto; padding:10px 20px;">+ Add User</button>
            </div>

            <h3 style="margin-bottom: 20px; border-bottom:1px solid #eee; padding-bottom:10px;">User List</h3>
            
            <table style="width:100%;">
                <thead>
                    <tr style="background:#F9FAFB;">
                        <th style="padding:15px;">Name</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for uid, u in users.items() %}
                    <tr style="border-bottom:1px solid #eee;">
                        <td style="padding:15px;">{{ u.name }}</td>
                        <td>{{ u.username }}</td>
                        <td>{{ u.email }}</td>
                        <td><span style="background:#EEF2FF; color:#4F46E5; padding:4px 8px; border-radius:6px; font-weight:700; font-size:0.8rem;">{{ u.role }}</span></td>
                        <td>
                            <div style="display:flex; gap:10px;">
                                <button onclick="openEditUser('{{ uid }}', '{{ u.name }}', '{{ u.username }}', '{{ u.email }}', '{{ u.role }}')" class="btn-icon btn-edit" style="width:32px; height:32px;"><i class="fas fa-edit"></i></button>
                                <a href="{{ url_for('admin_delete_user', user_id=uid) }}" class="btn-icon btn-delete" style="width:32px; height:32px;" onclick="return confirm('Delete user?')"><i class="fas fa-trash"></i></a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div id="addUserModal" class="modal"><div class="modal-content"><span class="close" onclick="this.parentElement.parentElement.style.display='none'">&times;</span><h3>Add User</h3><form action="{{ url_for('admin_add_user') }}" method="POST"><div class="form-group"><label>Name</label><input type="text" name="name" required></div><div class="form-group"><label>Username</label><input type="text" name="username" required></div><div class="form-group"><label>Email</label><input type="email" name="email" required></div><div class="form-group"><label>Password</label><input type="text" name="password" required></div><div class="form-group"><label>Role</label><select name="role"><option value="user">User</option><option value="admin">Admin</option></select></div><button type="submit" class="btn">Create</button></form></div></div>
    
    <div id="editUserModal" class="modal"><div class="modal-content"><span class="close" onclick="this.parentElement.parentElement.style.display='none'">&times;</span><h3>Edit User</h3><form action="{{ url_for('admin_edit_user') }}" method="POST"><input type="hidden" name="user_id" id="editUserId"><div class="form-group"><label>Name</label><input type="text" name="name" id="editName"></div><div class="form-group"><label>Email</label><input type="email" name="email" id="editEmail"></div><div class="form-group"><label>Role</label><select name="role" id="editRole"><option value="user">User</option><option value="admin">Admin</option></select></div><div class="form-group"><label>New Password</label><input type="text" name="password"></div><button type="submit" class="btn">Update</button></form></div></div>

    <script>
        function openEditUser(id,name,username,email,role){document.getElementById('editUserId').value=id;document.getElementById('editName').value=name;document.getElementById('editEmail').value=email;document.getElementById('editRole').value=role;document.getElementById('editUserModal').style.display='flex';}
    </script>
</body>
</html>